<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Sheeet</title>
    <link data-trunk rel="rust" data-bin="sheeet">
    <link data-trunk rel="css" href="index.css">
    <link data-trunk rel="copy-file" href="pkg/test.js">
    <link data-trunk rel="copy-file" href="pkg/test_bg.wasm">
</head>
<body>

<!-- This script is integral for the prototype to work. -->
<script type="module">
    // This function is called from Rust to evaluate the user functions.
    // TODO: I am really not sure about performance of this, it is a working prototype.
    window.evaluate = function (fnName, vars) {
        return window.userWasmModule[fnName](...vars)
    }

    // This function would be called on reload.
    // Should also work with Trunk if supplied with correct urls. 
    async function loadWasmBindgenModule(jsUrl, wasmUrl) {
        const module = await import(jsUrl);
        await module.default(wasmUrl);
        window.userWasmModule = module;
    }

    // Simulate first reload.
    // TODO: Handle via "Compile" button or call on init.
    await loadWasmBindgenModule('/test.js', '/test_bg.wasm');
</script>

<!-- This script just enables interactively call the Rust WASM to test it. -->
<script type="module">
    const INITIALIZED_EVENT_NAME = "TrunkApplicationStarted"
    await new Promise((resolve) => {
        addEventListener(INITIALIZED_EVENT_NAME, () => {
            console.log(window.wasmBindings);
            resolve();
        });
    });
    document.getElementById('my-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        await window.wasmBindings.run_evaluate();
    });
</script>

<form id="my-form">
    <input type="submit">
</form>

</body>
</html>